<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalles del informe</title>
  <div th:include="navbar :: head (titulo='Detalles de Informe')"></div>
  <link rel="stylesheet" th:href="@{/css/custom/global/global.css}">
  <link rel="stylesheet" th:href="@{/css/custom/profesional_medico/ver-detalles-informe.css}">

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

</head>
<body>
<div th:replace="navbar::menuBar"></div>
  <div class="body">
    <h1 class="page-title">Detalles del informe</h1>

    <div class="report-card">
      <!-- Modified: "Id. informe:" in bold and the number normal -->
      <div class="report-id"><strong>Id. informe:</strong> <span th:text="${informe.identificadorPublico}" class="report-number"></span></div>

      <div class="report-section">
        <div class="report-label">T√≠tulo: </div>
        <div th:text="${informe.titulo}" class="report-value"></div>
      </div>

      <div class="report-section">
        <div class="report-label">Descripci√≥n: </div>
        <div th:text="${informe.descripcion}" class="report-value"> </div>
      </div>

      <div class="report-section">
        <div class="report-label">Observaciones: </div>
        <div th:text="${informe.observaciones}" class="report-value"> </div>
      </div>

      <div class="report-section">
        <div class="report-label">Fecha de creaci√≥n: </div>
        <div th:text="${informe.fechaCreacion}" class="report-value"> </div>
      </div>

      <div class="report-section">
        <div class="report-label">Nombre del paciente: </div>
        <div th:text="${informe.paciente.usuario.nombreCompleto}" class="report-value"> </div>
      </div>

      <div class="report-section">
        <div class="report-label">Edad del paciente: </div>
        <div th:text="${informe.paciente.edad}" class="report-value"> </div>
      </div>

      <div class="report-section">
        <div class="report-label">N¬∫ del documento de identidad del paciente: </div>
        <div th:text="${informe.paciente.usuario.nifNie}" class="report-value"> </div>
      </div>

      <div class="report-section">
        <div class="report-label">Nombre del profesional m√©dico: </div>
        <div th:text="${informe.profesionalMedico.usuario.nombreCompleto}" class="report-value"> </div>
      </div>

      <div class="report-section">
        <div class="report-label">Especialidad m√©dica: </div>
        <div th:text="${informe.profesionalMedico.especialidadMedica.nombre}" class="report-value"> </div>
      </div>

      <div class="report-section">
        <div class="report-label">N¬∫ del documento de identidad del profesional m√©dico: </div>
        <div th:text="${informe.profesionalMedico.usuario.nifNie}" class="report-value"> </div>
      </div>

      <div class="report-section">
        <div class="report-label">Nombre del centro m√©dico: </div>
        <div th:text="${informe.centroMedicoUsuario.nombreCompleto}" class="report-value"> </div>
      </div>

      <div class="report-section">
        <div class="report-label">NIF del centro m√©dico: </div>
        <div th:text="${informe.centroMedicoUsuario.nifNie}" class="report-value"> </div>
      </div>

      <div class="report-section">
        <div class="report-label">Provincia del centro m√©dico: </div>
        <div th:text="${informe.centroMedicoUsuario.provincia}" class="report-value"> </div>
      </div>

      <div class="report-section">
        <div class="report-label">Municipio del centro m√©dico: </div>
        <div th:text="${informe.centroMedicoUsuario.municipio}" class="report-value"> </div>
      </div>

      <div class="report-section">
        <div class="report-label">Direcci√≥n del centro m√©dico: </div>
        <div th:text="${informe.profesionalMedico.centroMedico.direccion}" class="report-value"> </div>
      </div>

      <br>
      <hr>
      <br>
      <div class="report-id"><strong>Documentos del informe</strong></div>

      <div th:if="${noHayDocumentos == true}" class="no-documents-message">
        <p>No existe actualmente ning√∫n documento asociado a este informe m√©dico</p>
      </div>

      <div th:if="${noHayDocumentos == false}" class="files-section">
        <br>
        <h2 class="files-title">Documentos previamente adjuntados</h2>

        <div th:each="documento: ${documentos}" >
          <a th:href="${documento.urlPrefirmada}" th:text="${documento.nombre}" target="_blank" class="file-link"></a>
        </div>
        <br>
      </div>

      <br>
      <br>

      <div th:if="${profesionalMedicoAutenticadoId == informe.profesionalMedico.id}" >
        <form th:action="@{'/api/profesional-medico/pacientes/informes/' + ${informe.id} + '/subir-documentos'}"
              method="post"
              enctype="multipart/form-data"
              id="uploadForm">
          <div class="form-section">
            <h2 class="report-id">Adjuntar nuevos documentos para el informe</h2>

            <label for="fileInput" class="attachment-button">
              Adjuntar
              <span class="attachment-icon">‚ñº</span>
            </label>
            <input
              type="file"
              id="fileInput"
              name="documentos"
              multiple required
              style="display: none;"
              accept="application/pdf,image/jpeg,image/png,.pdf,.jpg,.jpeg,.png">

            <div id="selectedFiles" class="selected-files" style="display: none;">
              <h3>Nuevos ficheros adjuntados</h3>
            </div>

          </div>

          <br>

          <div class="button-container">
            <button type="submit" class="back-button">Subir ficheros</button>
          </div>

        </form>

      </div>


    </div>




  </div>
<div th:replace="navbar::javascript"></div>

<div th:replace="footer :: footer"></div>

<script>
  lucide.createIcons();
</script>

<script>
  const fileInput = document.getElementById('fileInput');
  const selectedFilesContainer = document.getElementById('selectedFiles');

  fileInput.addEventListener('change', function () {
    const files = Array.from(fileInput.files);
// Preservamos el h3 original si existe
    const heading = selectedFilesContainer.querySelector('h3');
    selectedFilesContainer.innerHTML = '';
    if (heading) selectedFilesContainer.appendChild(heading);


    if (files.length > 0) {
      selectedFilesContainer.style.display = 'block';
      files.forEach(file => {
        const fileElement = document.createElement('div');
        fileElement.className = 'selected-file-item';
        fileElement.textContent = `üìé ${file.name}`;
        selectedFilesContainer.appendChild(fileElement);
      });
    } else {
      selectedFilesContainer.style.display = 'none';
    }
  });
</script>

</body>
</html>
